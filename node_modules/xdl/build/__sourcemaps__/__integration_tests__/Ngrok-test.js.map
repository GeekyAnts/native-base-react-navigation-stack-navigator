{"version":3,"sources":["__integration_tests__/Ngrok-test.js"],"names":["jest","useRealTimers","jasmine","DEFAULT_TIMEOUT_INTERVAL","request","require","path","xdl","describe","xit","async","let","projectRoot","resolve","__dirname","await","Project","startAsync","ngrokUrl","getUrlAsync","urlType","hostType","Error","response","promise","get","body","responseValue","JSON","parse","error","statusCode","console","log","bundleUrl","bundleResponse","includes","stopAsync"],"mappings":"AAAA;;;;AAIA;;;;AAEAA,KAAKC,aAALD;AACAE,QAAQC,wBAARD,GAAmC,KAAnCA;;AAEA,MAAME,UAAUC,OAAVD,WAAN;AACA,MAAME,OAAOD,OAAPC,QAAN;;AAEA,MAAMC,MAAMF,QAAQ,QAARA,CAAZ;;AAEAG,SAAS,OAATA,EAAkB,MAAM;AACtBC,MAAI,oCAAJA,oBAA0CC,aAAY;AACpDC,QAAIC,cAAcN,KAAKO,OAALP,CAAaQ,SAAbR,EAAwB,uCAAxBA,CAAlBK;AACAI,UAAMR,IAAIS,OAAJT,CAAYU,UAAZV,CAAuBK,WAAvBL,CAANQ;AACAJ,QAAIO,WAAWH,MAAMR,IAAIS,OAAJT,CAAYY,WAAZZ,CAAwBK,WAAxBL,EAAqC;AACxDa,eAAS,MAD+C;AAExDC,gBAAU;AAF8C,KAArCd,CAArBI;AAIA,QAAI,CAACO,QAAL,EAAe;AACb,YAAM,IAAII,KAAJ,CAAU,2BAAV,CAAN;AACF;AACAX,QAAIY,WAAWR,MAAMX,QAAQoB,OAARpB,CAAgBqB,GAAhBrB,CAAoBc,QAApBd,CAArBO;AACA,QAAI,CAACY,SAASG,IAAd,EAAoB;AAClB,YAAM,IAAIJ,KAAJ,CAAU,uCAAV,CAAN;AACF;AACAX,QAAIgB,gBAAgBC,KAAKC,KAALD,CAAWL,SAASG,IAApBE,CAApBjB;AACA,QAAIgB,cAAcG,KAAdH,IAAuBJ,SAASQ,UAATR,KAAwB,GAAnD,EAAwD;AACtD,YAAM,IAAID,KAAJ,CAAU,qCAAqCK,cAAcG,KAA7D,CAAN;AACF;;AAEAE,YAAQC,GAARD,CAAY,qEAAZA;;AAEArB,QAAIuB,YAAYP,cAAcO,SAA9BvB;AACAqB,YAAQC,GAARD,CAAa,sBAAqBE,SAAU,EAA5CF;AACArB,QAAIwB,iBAAiBpB,MAAMX,QAAQoB,OAARpB,CAAgBqB,GAAhBrB,CAAoB8B,SAApB9B,CAA3BO;AACA,QAAI,CAACwB,eAAeT,IAAhB,IAAwB,CAACS,eAAeT,IAAfS,CAAoBC,QAApBD,CAA6B,kBAA7BA,CAA7B,EAA+E;AAC7E,YAAM,IAAIb,KAAJ,CAAU,qCAAV,CAAN;AACF;;AAEA,QAAIa,eAAeJ,UAAfI,KAA8B,GAAlC,EAAuC;AACrC,YAAM,IAAIb,KAAJ,CAAU,8CAA8Ca,eAAeJ,UAAvE,CAAN;AACF;;AAEAhB,UAAMR,IAAIS,OAAJT,CAAY8B,SAAZ9B,CAAsBK,WAAtBL,CAANQ;AACD,GAjCDN;AAkCD,CAnCDD","file":"../../__integration_tests__/Ngrok-test.js","sourcesContent":["/**\n * Tests setting up an ngrok tunnel\n *\n */\n'use strict';\n\njest.useRealTimers();\njasmine.DEFAULT_TIMEOUT_INTERVAL = 60000;\n\nconst request = require('request');\nconst path = require('path');\n\nconst xdl = require('../xdl');\n\ndescribe('ngrok', () => {\n  xit('starts running and serves manifest', async () => {\n    let projectRoot = path.resolve(__dirname, '../../../../apps/new-project-template');\n    await xdl.Project.startAsync(projectRoot);\n    let ngrokUrl = await xdl.Project.getUrlAsync(projectRoot, {\n      urlType: 'http',\n      hostType: 'tunnel',\n    });\n    if (!ngrokUrl) {\n      throw new Error(\"ngrok didn't return a URL\");\n    }\n    let response = await request.promise.get(ngrokUrl);\n    if (!response.body) {\n      throw new Error(\"Didn't get expected manifest response\");\n    }\n    let responseValue = JSON.parse(response.body);\n    if (responseValue.error || response.statusCode !== 200) {\n      throw new Error(\"Server responded with an error: \" + responseValue.error);\n    }\n\n    console.log(\"Successfully fetched manifest through ngrok and everything seems OK\");\n\n    let bundleUrl = responseValue.bundleUrl;\n    console.log(`Fetching bundle at ${bundleUrl}`);\n    let bundleResponse = await request.promise.get(bundleUrl);\n    if (!bundleResponse.body || !bundleResponse.body.includes('sourceMappingURL')) {\n      throw new Error(\"Didn't get expected bundle response\");\n    }\n\n    if (bundleResponse.statusCode !== 200) {\n      throw new Error(\"Packager responded with bad status code: \" + bundleResponse.statusCode);\n    }\n\n    await xdl.Project.stopAsync(projectRoot);\n  });\n});\n"],"sourceRoot":"/xdl/src"}